<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">

      input[type='number']{
        width:100%;
        height:250px;
        font-size:30px;
        text-align: center;
        margin-bottom:10px;
        border:2px solid #51cbce;
        color:#66615b;
        border-radius: 10px

      }
      input:focus {
          outline: none !important;
          border:2px solid #51cbce;
          color:#66615b;
          box-shadow: 0 0 10px #719ECE;

      }
      /*! CSS Used from: Embedded ; media=screen */
@media screen{
*,::after,::before{box-sizing:border-box;}
h3{margin-top:0;margin-bottom:.5rem;}
p{margin-top:0;margin-bottom:1rem;}
b{font-weight:bolder;}
a{color:#007bff;text-decoration:none;background-color:transparent;}
a:hover{color:#0056b3;text-decoration:underline;}
img{vertical-align:middle;border-style:none;}
h3{margin-bottom:.5rem;font-weight:500;line-height:1.2;}
h3{font-size:1.75rem;}
.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px;}
.col-md-3,.col-md-4,.col-md-8,.col-md-6{position:relative;width:100%;padding-right:15px;padding-left:15px;}
@media (min-width:768px){
.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%;}
.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%;}
}
.card{position:relative;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;min-width:0;word-wrap:break-word;background-color:#fff;background-clip:border-box;border:1px solid rgba(0,0,0,.125);border-radius:.25rem;}
.card-body{-ms-flex:1 1 auto;flex:1 1 auto;padding:1.25rem;}
.card-title{margin-bottom:.75rem;}
@media print{
*,::after,::before{text-shadow:none!important;box-shadow:none!important;}
img{page-break-inside:avoid;}
h3,p{orphans:3;widows:3;}
h3{page-break-after:avoid;}
}
a,h3,p{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:'Comic Sans MS',cursive,sans-serif;font-weight:300;}
h3{margin:30px 0 0;}
h3{font-size:1.825em;line-height:1.4;margin:20px 0 0;}
p{line-height:1.5em;}
p{font-size:15px;margin-bottom:5px;}
.desc{font-size:18px!important;}
.card-title{font-family:'Comic Sans MS',cursive,sans-serif;}
.card-title,.card-title a{color:#333;text-decoration:none;}
a{color:#51bcda;}
a:focus,a:hover{color:#2ba9cd;text-decoration:none;}
a:active,a:focus{outline:0;}
::-moz-placeholder{color:#9a9a9a;}
:-ms-input-placeholder{color:#9a9a9a;}
::-webkit-input-placeholder{color:#9a9a9a;}
.card{border-radius:12px;box-shadow:0 6px 10px -4px rgba(0,0,0,.15);background-color:#fff;color:#333;margin-bottom:20px;position:relative;z-index:1;border:0 none;transition:transform .3s cubic-bezier(.34,2,.6,1),box-shadow .2s ease;}
.card1{box-shadow:0 6px 10px -4px rgba(0,0,0,.15);background-color:#fff;color:#333;margin-bottom:20px;position:relative;z-index:1;border:0 none;transition:transform .3s cubic-bezier(.34,2,.6,1),box-shadow .2s ease;}

.card .card-description{color:#9a9a9a;margin-bottom:5px;margin-top:15px;}
.card img{height:auto;border-radius:12px 12px 0 0;}
.card.card-plain{background-color:transparent;box-shadow:none;border-radius:0;}
.card.card-plain .card-body{padding-left:5px;padding-right:5px;}
.card.card-plain img{border-radius:12px;}
.card.card-blog{margin-top:30px;}
.card.card-blog .card-image .img{border-radius:12px;}
.card.card-blog{margin-top:5px;}
.card .author{display:inline-block;}
.card .card-body{padding:20px;}
.card .card-body .card-title{margin:5px 0 0;}
.card-plain{background-color:transparent;box-shadow:none;border-radius:0;}
.card-plain .card-body{padding-left:5px;padding-right:5px;}
.card-plain img{border-radius:12px;}
.card.card-blog [class*=col-] .card-image .img{border-radius:12px;}
.blog-3 .card-blog{margin-bottom:40px;}
}
.col-md-6{-webkit-box-flex:0;-ms-flex:0 0 50%;flex:0 0 50%;max-width:45%;margin-left:30px }
.col-md-4{-webkit-box-flex:0;-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}
.scroll {
                margin:4px, 4px;
                padding:4px;
                background-color:#f9f9f9;
                width: 500px;
                height: 300px;
                overflow-x: hidden;
                overflow-x: auto;
                text-align:justify;
                border:2px solid #51cbce;
                border-radius: 10px
            }


            /*! CSS Used from: Embedded ; media=screen */
            @media screen{
            *,::after,::before{box-sizing:border-box;}
            button{border-radius:0;}
            button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color;}
            button{margin:0;font-family:inherit;font-size:inherit;line-height:inherit;}
            button{overflow:visible;}
            button{text-transform:none;}
            [type=button],button{-webkit-appearance:button;}
            [type=button]::-moz-focus-inner,button::-moz-focus-inner{padding:0;border-style:none;}
            .btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;}
            @media (prefers-reduced-motion:reduce){
            .btn{transition:none;}
            }
            .btn:hover{color:#212529;text-decoration:none;}
            .btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25);}
            .btn:disabled{opacity:.65;}
            @media print{
            *,::after,::before{text-shadow:none!important;box-shadow:none!important;}
            }
            button{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Montserrat,Helvetica,Arial,sans-serif;font-weight:300;}
            button::-moz-focus-inner{outline:0;}
            .btn{box-sizing:border-box;border-width:2px;font-size:12px;font-weight:600;padding:.5rem 18px;line-height:1.75;cursor:pointer;text-transform:uppercase;background-color:#66615b;border-color:#66615b;color:#fff;opacity:1;filter:alpha(opacity=100);transition:all .15s linear;}
            .btn:active,.btn:active:focus,.btn:active:hover,.btn:focus,.btn:hover{background-color:#403d39;color:#fff;border-color:#403d39;box-shadow:none;}
            .btn:disabled,.btn:disabled:active,.btn:disabled:focus,.btn:disabled:hover{background-color:#403d39;border-color:#403d39;}
            .btn:active,.btn:focus,.btn:hover{outline:0!important;box-shadow:none;}
            .btn:disabled{opacity:.5;filter:alpha(opacity=50);}
            .btn-round{border-radius:30px;}
            ::-moz-placeholder{color:#9a9a9a;}
            :-ms-input-placeholder{color:#9a9a9a;}
            ::-webkit-input-placeholder{color:#9a9a9a;}
            *,::after,::before{box-sizing:border-box;}
            @media print{
            *,::after,::before{text-shadow:none!important;box-shadow:none!important;}
            }
            ::-moz-placeholder{color:#9a9a9a;}
            :-ms-input-placeholder{color:#9a9a9a;}
            ::-webkit-input-placeholder{color:#9a9a9a;}
            *,::after,::before{box-sizing:border-box;}
            @media print{
            *,::after,::before{text-shadow:none!important;box-shadow:none!important;}
            }
            ::-moz-placeholder{color:#9a9a9a;}
            :-ms-input-placeholder{color:#9a9a9a;}
            ::-webkit-input-placeholder{color:#9a9a9a;}
            }
            /*! CSS Used from: https://demos.creative-tim.com/paper-kit-2-pro/assets/css/bootstrap.min.css */
            *,::after,::before{box-sizing:border-box;}
            button{border-radius:0;}
            button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color;}
            button{margin:0;font-family:inherit;font-size:inherit;line-height:inherit;}
            button{overflow:visible;}
            button{text-transform:none;}
            [type=button],button{-webkit-appearance:button;}
            [type=button]::-moz-focus-inner,button::-moz-focus-inner{padding:0;border-style:none;}
            .btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;}
            @media (prefers-reduced-motion:reduce){
            .btn{transition:none;}
            }
            .btn:hover{color:#212529;text-decoration:none;}
            .btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25);}
            .btn:disabled{opacity:.65;}
            .btn-outline-primary{color:#007bff;border-color:#007bff;}
            .btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff;}
            .btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5);}
            .btn-outline-primary:disabled{color:#007bff;background-color:transparent;}
            .btn-block{display:block;width:100%;}
            @media print{
            *,::after,::before{text-shadow:none!important;box-shadow:none!important;}
            }
            /*! CSS Used from: https://demos.creative-tim.com/paper-kit-2-pro/assets/css/paper-kit.min.css?v=2.3.0 */
            button{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Montserrat,Helvetica,Arial,sans-serif;font-weight:300;}
            button::-moz-focus-inner{outline:0;}
            .btn{box-sizing:border-box;border-width:2px;font-size:12px;font-weight:600;padding:.5rem 18px;line-height:1.75;cursor:pointer;text-transform:uppercase;background-color:#66615b;border-color:#66615b;color:#fff;opacity:1;filter:alpha(opacity=100);transition:all .15s linear;}
            .btn:active,.btn:active:focus,.btn:active:hover,.btn:focus,.btn:hover{background-color:#403d39;color:#fff;border-color:#403d39;box-shadow:none;}
            .btn:disabled,.btn:disabled:active,.btn:disabled:focus,.btn:disabled:hover{background-color:#403d39;border-color:#403d39;}
            .btn:active,.btn:focus,.btn:hover{outline:0!important;box-shadow:none;}
            .btn[class*=btn-outline-]{background-image:none;background-color:transparent;}
            .btn-outline-primary{border-color:#51cbce;color:#51cbce;opacity:1;filter:alpha(opacity=100);}
            .btn-outline-primary:active,.btn-outline-primary:active:focus,.btn-outline-primary:active:hover,.btn-outline-primary:focus,.btn-outline-primary:hover{background-color:#51cbce!important;color:hsla(0,0%,100%,.8);border-color:#51cbce!important;}
            .btn-outline-primary:disabled,.btn-outline-primary:disabled:active,.btn-outline-primary:disabled:focus,.btn-outline-primary:disabled:hover{background-color:transparent;border-color:#51cbce;}
            .btn:disabled{opacity:.5;filter:alpha(opacity=50);}
            .btn-round{border-radius:30px;}
            ::-moz-placeholder{color:#9a9a9a;}
            :-ms-input-placeholder{color:#9a9a9a;}
            ::-webkit-input-placeholder{color:#9a9a9a;}
            /*! CSS Used from: Embedded */
            @media print{
            *{color:#000!important;text-shadow:none!important;background:0 0!important;-webkit-box-shadow:none!important;box-shadow:none!important;}
            }
            *,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}
            /*! CSS Used fontfaces */
            .card1{
              box-shadow:0 6px 10px -4px rgba(0,0,0,.15);
              background-color:#fff;
              color:#333;
              margin-bottom:5px;
              position:relative;
              z-index:1;
              border:0 none;
              transition:transform .3s cubic-bezier(.34,2,.6,1),box-shadow .2s ease;
              padding:5px
            }

    </style>


  </head>
  <body >

<h1 style="margin-top:10%"></h1>
<div class="row" >
  <div class="col-md-8" style="margin-left:5%">
    <div class=" card card-plain card-blog">
      <div class="row" style="margin-left:5%">
        <div class="col-md-3">
          <div class="card-image">
            <img style="width:175px;height:220px" class="img" src="<%=details.bookid.ImageURLL%>">
          </div>
        </div>
        <div  class="col-md-8">
          <div class="card-body">
            <!-- <h6 class="card-category text-info">Enterprise</h6> -->
            <h3 style="margin-bottom:1px;display:flex;flex-wrap:wrap" class="card-title">
              <a href="#pablo"><%=details.bookid.Title%></a>
            </h3 >&nbsp
            <p class="author">
              by
              <a href="#pablo">
                <b><%=details.bookid.Author%></b>
              </a>
            </p>

            <p  class="card-description desc">
              By <%=details.username%>  <br>
              Base Amount : <%=details.baseamount%>
            <br><br>
            </p>
          </div>

        </div>
      </div>
    </div>
    <br><br>

  </div>
  <div class="col-md-4" style="margin-left:-5%">
    <div class="card-body">
      <!-- <h6 class="card-category text-info">Enterprise</h6> -->
<%if(prevbids.length != 0){%>
      <p class="card-description desc">
        <span id="highbid">
        Highest bid : <%=baseamount%>
<br>
        By <%=user%>
        </span>
        <br>
        Time Left ::
        <span id='time'>1:00</span>
      <br>
      <i id='sold'></i>
      <br><br>
      </p>
      <!-- <p>Your highestbid :  </p> -->

      <%}else{%>
        <p id='appendhere' style="display:none" class="card-description desc">
          <span id="highbid">
          Highest bid : <%=baseamount%>
  <br>
          By <%=user%>
          </span>
          <br>
          Time Left ::
          <span id='time'>1:00</span>
        <br>
        <i id='sold'></i>
        <br><br>
        </p>

        <div id='inimsg' style="display:flex;flex-direction:row;justify-content:center;align-items:center;height:auto">
          <p class="card-description desc"  >Be the first person to bid</p>
        </div>

        <%}%>
    </div>



  </div>
</div>
<div class="row">
  <div class="col-md-6">
    <input type="number" name="message" id="message" min="0" placeholder="Rs 0" oninput="validity.valid||(value='');">

    <!-- <button type="button" name="button" id="send_message" >Bid amount</button> -->
<button class="btn btn-outline-primary btn-block " type="button" id="send_message" name="button">Bid amount</button>
  </div>
  <div class="col-md-6 scroll">
    <div style="height:300px;color:#9a9a9a" id="chatroom">
      <%if (prevbids.length==0) {%>

        <div style="display:flex;flex-direction:row;justify-content:center;align-items:center;height:280px">
                  <p style="font-size:1.2rem;text-align:center;color:#66615b !important" id="removeonbid">you can see here if anyone bids</p>
        </div>
      <%}else{%>
      <%for(i=prevbids.length -1 ;i>=0;i--){%>
          <p class='card1 message'><%=prevbids[i].username%> : <%=prevbids[i].amount%></p>
        <%}%>
<%}%>

    </div>


  </div>

</div>

<br><br>
<!-- <input type="text" name="username" id="username">
<button type="button" name="button" id="send_username" >send username</button> -->
<!-- <input type="text" name="message" id="message" > -->

<!-- <script type="text/javascript">

   $.ajax({
     type:'POST',
     url:'bidding',
     data:{
       bookid:id,
     },
     success:function(result){
       alert('Request has been sent to Owner');
       console.log(result);
       return true
     }
   });

</script> -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
<script type="text/javascript" src= 'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
<script type="text/javascript">

  var socket =  io.connect('http://127.0.0.1:3000');



  var message = $("#message")
  var username = $('#username')
  var send_message = $("#send_message")
  var send_username = $("#send_username")
  var chatroom = $("#chatroom")
  var feedback = $("#feedback")
  var highestbid = <%=baseamount%>
  socket.emit('join',{room:'<%=room%>'})
  // socket.emit('join',{room:'room'})
var a = [
  {'name':'koushik'},
  {'name':'koushik1'}
]

  send_username.click(()=>{
    console.log(username.val())
    socket.emit('change_username',{username:username.val()})
  })
  send_message.click(()=>{
    if(message.val() > highestbid){
      console.log(message.val());
      console.log(highestbid);
      socket.emit('new_message',{message:message.val(),room:'<%=room%>',bidid:'<%=bidid%>',username:'<%=username%>',userid:'<%=userid%>'})

    }else{
      alert('enter amount greater than highest bid')
    }
    // socket.emit('new_message',{message:message.val(),room:'room'})

    message.val('')
  })
  socket.on('new_message',(data)=>{
    highestbid = data.message
    chatroom.prepend("<p class='message card1'>" + data.username + ":" +data.message + '</p>')
    if(document.getElementById('removeonbid')){
      document.getElementById('removeonbid').remove()
    }
    if(document.getElementById('inimsg')){
      document.getElementById('inimsg').remove()

    }
    if(document.getElementById("appendhere")){
      document.getElementById("appendhere").style.display='block';
    }
    if(document.getElementById("highbid")){

      document.getElementById("highbid").innerHTML = "Highest bid :"+ data.message+
      "<br> By  " + data.username;


    }
    if(check===false){
    fiveMinutes = 30;
        display = document.querySelector('#time');
    startTimer(fiveMinutes, display);
}else{
  resetTimer()
}

    feedback.html(' ')
  })
  message.bind('keypress',()=>{
    socket.emit('typing',{room:'<%=room%>'})
  })
  socket.on('typing',(data)=>{
    feedback.html('<p><i>' + data.username +'/is typing a message...' +'</i></p>')
  })


  var timer;
  var check=false;
  function startTimer(duration, display) {
      timer = duration;
      var minutes, seconds;
      check = true;
      setInterval(function () {
          minutes = parseInt(timer / 60, 10)
          seconds = parseInt(timer % 60, 10);

          minutes = minutes < 10 ? "0" + minutes : minutes;
          seconds = seconds < 10 ? "0" + seconds : seconds;

          display.textContent = minutes + ":" + seconds;

          if (--timer < 0) {
              timer = 0;
              console.log('timeover')
              // alert('Time Over');
            document.getElementById('sold').innerHTML = 'sold';
            document.getElementById('send_message').disabled = true;
            socket.emit('sold',{room:'<%=room%>',bidid:'<%=bidid%>'})
            socket.close()
            location.href = "/book/allbidding"
          }
      }, 1000);
  }

  function resetTimer() {
    timer = 30;
  }
window.onload=function (){
  if('<%=lastbidtime%>'!=='false'){
    console.log('asdv')
    console.log('<%=lastbidtime%>')
    if(document.getElementById("appendhere")){
      document.getElementById("appendhere").style.display='block';
    }
    console.log(new Date().getTime(),new Date('<%=lastbidtime%>').getTime())
    console.log((new Date().getTime() - new Date('<%=lastbidtime%>').getTime())/1000)
    if((new Date().getTime() - new Date('<%=lastbidtime%>').getTime())/1000<30){
      fiveMinutes = 30-((new Date().getTime() - new Date('<%=lastbidtime%>').getTime())/1000);
          display = document.querySelector('#time');
          console.log('sddisplay',display)
      startTimer(fiveMinutes, display);
  }else{
    if(document.getElementById("appendhere")){
      document.getElementById("appendhere").style.display='block';
    }
    console.log('display')
    fiveMinutes=0;
    display = document.querySelector('#time').textContent="0:00";
    location.href = "/book/allbidding"
// startTimer(fiveMinutes, display);
document.getElementById('send_message').disabled = true;

  }


  }

  if(timer===0){

    document.getElementById('send_message').disabled = true;
    location.href = "/book/allbidding"
  }
}


</script>

  </body>
</html>
